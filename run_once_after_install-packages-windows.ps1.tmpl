{{ if eq .chezmoi.os "windows" }}
function Install([string] $package)
{
  If ((scoop info $package | Select-String -Quiet "Installed")) {
    scoop update $package
  } Else {
    scoop install $package
  }
}

foreach($line in (Get-Content "$HOME/.config/chezmoi/install_packages_list.txt" | Where {$_ -notmatch '^#.*'})) {
  if (-not ([string]::IsNullOrEmpty($line))) {
    Install $line
  }
}

winget install Microsoft.DotNet.SDK.8
npm install -g neovim

# Create a powershell profile
$PSHomeDir = "$HOME\Documents\PowerShell"
$Profile = "Profile.ps1"
If (!(Test-Path "$PSHomeDir")) {
  New-Item -Path "$HOME\Documents" -Name "PowerShell" -ItemType "directory"
}
If (!(Test-Path "$PSHomeDir\$Profile")) {
  New-Item -Path "$PSHomeDir" -Name "$Profile" -ItemType SymbolicLink -Target "$HOME\.config\powershell\profile.ps1" -Force
}

# zsh in msys2
Install msys2
$Msys2HomePath = "$HOME\scoop\apps\msys2\current\home\$env:username"
If (Test-Path -Path $Msys2HomePath) {
  $Msys2HomeDir = Get-Item "$Msys2HomePath"
  If (!([bool]($Msys2HomeDir.Attributes -band [IO.FileAttributes]::ReparsePoint))) {
    echo "Remove $Msys2HomePath"
    Remove-Item -LiteralPath "$Msys2HomePath" -Force -Recurse
  }
}
If (!(Test-Path -Path $Msys2HomePath)) {
    echo "Create Symlink"
    New-Item -ItemType SymbolicLink -Path "$Msys2HomePath" -Target "$HOME" # symbolic link ~ -> $HOME
}
{{ end }}
